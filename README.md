# SelShop — Интернет-магазин

## Описание

**SelShop** — это полнофункциональный интернет-магазин, построенный на базе **микросервисной архитектуры**.

Проект позволяет:

- просматривать товары,
- добавлять их в корзину,
- оформлять заказы,
- управлять личными аккаунтами.

Администраторы могут управлять каталогом продуктов и обрабатывать отзывы.  
Для безопасности используется **Keycloak** (oAuth2).

---

## Для работы понадобиться

- Maven 3+
- Docker

## Функциональные возможности

- **Управление каталогом товаров**: CRUD-операции через REST API (MVC).
- **Корзина и заказы**: добавление товаров, оформление заказов с аутентификацией.
- **Отзывы**: пользователи оставляют отзывы через реактивный REST API.
- **Приложения**:
    - `customer-app`: реактивный интерфейс для покупателей (просмотр, покупки).
    - `manager-app`: MVC-интерфейс для администраторов (управление контентом).
- **Сервис обнаружения и маршрутизации**:
    - *Eureka* (регистрация сервисов).
    - *API Gateway* (маршрутизация запросов).
- **Централизованная конфигурация**: Config Server.
- **Мониторинг и администрирование**: Admin Server (метрики и состояние приложений).
- **Кэширование**: Redis (сессии, кэш запросов, оптимизация).
- **Безопасность**: Keycloak (OAuth2-аутентификация и авторизация).

---

## Технологии

- **Язык**: Java 11+
- **Фреймворки**:
    - Spring Boot (MVC + WebFlux)
    - Spring Cloud Netflix (Eureka)
    - Spring Cloud Gateway
- **Базы данных**: PostgreSQL
- **Кэш**: Redis
- **Безопасность**: Keycloak + Spring Security
- **Сборка**: Maven (multi-module)
- **Контейнеризация**: Docker, Docker Compose
- **Дополнительно**: Lombok

---

## Установка и запуск

Установка выполняется через **Docker**. Требуется установленный **Maven** и **Docker**.

### Пошаговая инструкция

1. **Клонирование репозитория**:
   ```bash
   git clone https://github.com/chotchipWeb/internet-shop.git
   cd selShop-parent
   ```

2. **Сборка проекта (пропуск тестов для ускорения):**

```bash
   mvn clean install -DskipTests
```

3. **Переход в Docker-директорию:**

```bash
   cd docker
```

4. **Запуск контейнеров:**

```bash
   docker-compose up -d
```

-d — запуск в фоне. Поднимутся PostgreSQL, Redis, Eureka, API Gateway и приложения. Подождите 1–2 минуты.

5. **Проверка запуска:**

* Eureka Dashboard → http://localhost:8761

* API Gateway → http://localhost:8086

* Customer App → http://localhost:8081

* Manager App → http://localhost:8082

- Особенности

* Все сервисы автоматически регистрируются в Eureka.

* Если порты заняты — редактируйте docker-compose.yml

## Доступы и учётные записи

После запуска контейнеров можно войти в разные сервисы с предустановленными логинами и паролями:

- **Keycloak (администратор)**
    - URL: [http://localhost:8082/auth](http://localhost:8082/)
    - Логин: `admin`
    - Пароль: `admin`

- **Manager App (администратор магазина)**
    - URL: [http://localhost:8080](http://localhost:8080)
    - Логин: `admin`
    - Пароль: `123`

- **Customer App (покупатель)**
    - URL: [http://localhost:8081](http://localhost:8081)
    - Логин: `user`
    - Пароль: `123`


- **Config-app**
    - URL: [http://localhost:8088](http://localhost:8088)
    - Логин: `1234`
    - Пароль: `pass`

---

## Использование

### Примеры API-запросов (через Postman / curl, после авторизации в Keycloak)

- **Получить товары**:
  ```http
  GET http://localhost:8080/catalogue-service/products
   ```

- **Добавить отзыв**:

 ```http
  POST http://localhost:8084/feedback-service/reviews
   ```

+ Для начала загляните в Eureka: http://localhost:8761 — там видно все активные сервисы.

## Работа с API Gateway

**Пример запроса:**  
`http://localhost:8086/manager-app/catalogue/products/create`

### Как это работает:

1. **Запрос приходит на API Gateway** (порт 8086).

2. **Перенаправление через Eureka**:

- Gateway отправляет запрос на `manager-app` (порт 8082)

3. **Обработка запроса в Manager-app**:

- Контроллер: `manager-app/catalogue/products/create`
- GET-запрос — отображение формы
- POST-запрос — сохранение нового товара
- Данные сохраняются в PostgreSQL
- Redis кэширует список товаров для ускорения

4. **Безопасность**:

- Gateway проверяет токен от Keycloak (роль `admin`)
- Если токен валиден → доступ разрешён
- Иначе → `403 Forbidden`

5. **Ответ клиенту**:

- HTML-страница (MVC) или JSON (API) возвращается обратно через Gateway



